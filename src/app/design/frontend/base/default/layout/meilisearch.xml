<?xml version="1.0"?>
<layout>
    <!-- Base Meilisearch configuration and assets -->
    <meilisearch_search_handle>
        <reference name="head">
            <!-- Configuration template with window.meilisearchConfig -->
            <block type="core/template" before="js" template="meilisearch/internals/configuration.phtml" name="meilisearch-configuration"/>

            <!-- Vanilla CSS - No jQuery dependencies -->
            <action method="addCss"><stylesheet>meilisearch/autocomplete-vanilla.css</stylesheet></action>
        </reference>
    </meilisearch_search_handle>

    <!-- Search box replacement with Meilisearch template -->
    <meilisearch_search_handle_with_topsearch>
        <reference name="top.search">
            <action method="setTemplate"><template>meilisearch/autocomplete.phtml</template></action>
        </reference>
    </meilisearch_search_handle_with_topsearch>

    <!-- Autocomplete JavaScript - Pure Vanilla JS -->
    <meilisearch_search_handle_autocomplete>
        <reference name="head">
            <action method="addJs"><script>meilisearch/autocomplete-vanilla.js</script></action>
        </reference>
    </meilisearch_search_handle_autocomplete>

    <!-- Instant search (disabled for now - can be added later if needed) -->
    <meilisearch_search_handle_instantsearch>
        <!-- Instant search can be added here later with vanilla JS -->
    </meilisearch_search_handle_instantsearch>

    <!-- Backend rendering prevention (for instant search pages) -->
    <meilisearch_search_handle_prevent_backend_rendering>
        <reference name="left_first">
            <action method="unsetChild"><name>catalog.leftnav</name></action>
            <action method="unsetChild"><name>catalogsearch.leftnav</name></action>
        </reference>

        <reference name="left">
            <action method="unsetChild"><name>tags_popular</name></action>
        </reference>

        <reference name="content">
            <action method="unsetChild"><name>category.products</name></action>
            <action method="unsetChild"><name>search.result</name></action>
        </reference>

        <reference name="right">
            <action method="unsetChild"><name>right.reports.product.viewed</name></action>
            <action method="unsetChild"><name>left.reports.product.viewed</name></action>
            <action method="unsetChild"><name>right.poll</name></action>
        </reference>
    </meilisearch_search_handle_prevent_backend_rendering>

</layout>
